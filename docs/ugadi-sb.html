<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ugadi Pachadi Maker</title>
  <style>
    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    
    :root {
      --easy-color: #4ade80; /* green-400 */
      --medium-color: #facc15; /* yellow-400 */
      --hard-color: #f87171; /* red-400 */
    }
    
    body {
      background-color: #fffbeb; /* amber-50 */
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      min-height: 100vh;
    }
    
    .container {
      width: 100%;
      max-width: 640px;
      margin: 0 auto;
    }
    
    /* Typography */
    h1 {
      font-size: 1.875rem;
      font-weight: bold;
      color: #c2410c; /* orange-700 */
      margin-bottom: 0.5rem;
      text-align: center;
    }
    
    h2 {
      font-size: 1.5rem;
      font-weight: bold;
      color: #ea580c; /* orange-600 */
      margin-bottom: 0.75rem;
    }
    
    h3 {
      font-size: 1.25rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    /* Hint text */
    .hint-text {
      font-size: 0.75rem;
      text-align: center;
      color: #4b5563; /* gray-600 */
      font-style: italic;
    }

    /* Button styles */
    button {
      background-color: #f97316; /* orange-500 */
      color: white;
      font-weight: bold;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s;
      min-height: 44px; /* Mobile-friendly touch target */
    }
    
    button:hover {
      background-color: #ea580c; /* orange-600 */
    }
    
    button.secondary {
      background-color: #6b7280; /* gray-500 */
    }
    
    button.secondary:hover {
      background-color: #4b5563; /* gray-600 */
    }
    
    /* Screens */
    .screen {
      background-color: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 32rem;
      width: 100%;
      margin: 0 auto;
    }
    
    /* Cultural context */
    .cultural-context {
      background-color: #f8fafc; /* slate-50 */
      border: 1px solid #cbd5e1; /* slate-300 */
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      font-size: 0.875rem;
    }
    
    .cultural-context-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      color: #c2410c; /* orange-700 */
    }
    
    /* Difficulty selector */
    .difficulty-selector {
      display: flex;
      gap: 0.5rem;
      margin: 1rem 0;
    }
    
    .difficulty-btn {
      flex: 1;
      text-align: center;
      padding: 0.75rem 0.5rem;
      border: 2px solid transparent;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .difficulty-btn.easy {
      background-color: rgba(74, 222, 128, 0.2);
      color: #166534; /* green-800 */
    }
    
    .difficulty-btn.medium {
      background-color: rgba(250, 204, 21, 0.2);
      color: #854d0e; /* yellow-800 */
    }
    
    .difficulty-btn.hard {
      background-color: rgba(248, 113, 113, 0.2);
      color: #991b1b; /* red-800 */
    }
    
    .difficulty-btn.selected {
      border-color: currentColor;
      background-color: rgba(74, 222, 128, 0.4);
    }
    
    .difficulty-btn.easy.selected {
      background-color: rgba(74, 222, 128, 0.4);
    }
    
    .difficulty-btn.medium.selected {
      background-color: rgba(250, 204, 21, 0.4);
    }
    
    .difficulty-btn.hard.selected {
      background-color: rgba(248, 113, 113, 0.4);
    }
    
    /* Instructions screen */
    ul.instructions {
      list-style-type: disc;
      padding-left: 1.25rem;
      margin-bottom: 1rem;
    }
    
    ul.instructions li {
      margin-bottom: 0.5rem;
    }
    
    ul.instructions ul {
      list-style-type: disc;
      padding-left: 1.25rem;
      margin-top: 0.25rem;
    }
    
    ul.instructions ul li {
      margin-bottom: 0.25rem;
    }
    
    /* Game HUD */
    .game-hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .hud-item {
      display: flex;
      align-items: center;
      background-color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
    }
    
    .hud-item.active {
      background-color: #bfdbfe; /* blue-200 */
      animation: pulse 2s infinite;
    }
    
    .hud-item.difficulty-indicator {
      font-size: 0.75rem;
    }
    
    .hud-item.difficulty-indicator.easy {
      background-color: rgba(74, 222, 128, 0.3);
      color: #166534; /* green-800 */
    }
    
    .hud-item.difficulty-indicator.medium {
      background-color: rgba(250, 204, 21, 0.3);
      color: #854d0e; /* yellow-800 */
    }
    
    .hud-item.difficulty-indicator.hard {
      background-color: rgba(248, 113, 113, 0.3);
      color: #991b1b; /* red-800 */
    }
    
    .hud-items-group {
      display: flex;
      gap: 1rem;
    }
    
    /* Active powerup */
    .active-powerup {
      background-color: #dbeafe; /* blue-100 */
      color: #1e40af; /* blue-800 */
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0 auto 0.5rem;
      width: fit-content;
      animation: pulse 2s infinite;
    }
    
    /* Vessel */
    .vessel-container {
      margin-bottom: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .vessel {
      width: 10rem;
      height: 10rem;
      border-radius: 50%;
      border: 4px solid #ca8a04; /* yellow-600 */
      background-color: #e2e8f0; /* Changed from #fef9c3 to slate-200 for better salt contrast */
      position: relative;
      overflow: hidden;
    }
    
    /* Taste indicators */
    .taste-indicators {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
      width: 100%;
    }
    
    .taste-indicator {
      text-align: center;
    }
    
    .taste-value {
      width: 1.5rem;
      height: 1.5rem;
      margin: 0 auto 0.25rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
    }
    
    .taste-name {
      font-size: 0.75rem;
    }
    
    /* Conveyor belt */
    .conveyor-belt {
      background-color: #d1d5db; /* gray-300 */
      height: 6rem;
      position: relative;
      overflow: hidden;
      border-radius: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .conveyor-roller-left {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 1.5rem;
      background-color: #6b7280; /* gray-500 */
      border-top-left-radius: 0.5rem;
      border-bottom-left-radius: 0.5rem;
    }
    
    .conveyor-roller-right {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 1.5rem;
      background-color: #6b7280; /* gray-500 */
      border-top-right-radius: 0.5rem;
      border-bottom-right-radius: 0.5rem;
    }
    
    .conveyor-track-top {
      position: absolute;
      top: 0;
      width: 100%;
      height: 0.5rem;
      background-color: #9ca3af; /* gray-400 */
    }
    
    .conveyor-track-bottom {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0.5rem;
      background-color: #9ca3af; /* gray-400 */
    }
    
    .ingredient {
      position: absolute;
      cursor: pointer;
      transition: all 0.3s;
      bottom: 25%;
    }
    
    .ingredient-visual {
      width: 3.5rem;
      height: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transform: scale(1);
      transition: transform 0.2s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .ingredient-visual:hover {
      transform: scale(1.1);
    }
    
    .ingredient-img {
      width: 80%;
      height: 80%;
      border-radius: 0.25rem;
      object-fit: contain;
    }
    
    .ingredient-shape {
      background-color: inherit;
    }
    
    .ingredient-shape.square {
      width: 2.5rem;
      height: 2.5rem;
      background-color: #92400e; /* yellow-800 */
      border-radius: 0.25rem;
    }
    
    .ingredient-shape.oval {
      width: 2.5rem;
      height: 2rem;
      background-color: #78350f; /* yellow-900 */
      border-radius: 9999px;
    }
    
    .ingredient-shape.circle {
      width: 2rem;
      height: 2rem;
      background-color: #bef264; /* lime-300 */
      border-radius: 50%;
    }
    
    .ingredient-shape.long {
      width: 1rem;
      height: 2.5rem;
      background-color: #15803d; /* green-700 */
      border-radius: 9999px;
    }
    
    .ingredient-shape.crystal {
      width: 2rem;
      height: 2rem;
      background-color: white;
      border-radius: 0.25rem;
    }
    
    .ingredient-shape.slice {
      width: 2.5rem;
      height: 1.5rem;
      background-color: #a3e635; /* lime-400 */
      border-radius: 0.5rem;
    }
    
    .ingredient-label {
      font-size: 0.75rem;
      font-weight: bold;
      margin-top: 0.25rem;
      text-align: center;
      background-color: white;
      border-radius: 0.25rem;
      padding: 0.125rem 0.25rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* Powerup on conveyor */
    .powerup {
      position: absolute;
      cursor: pointer;
      transition: all 0.3s;
      bottom: 25%;
    }
    
    .powerup-visual {
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transform: scale(1);
      transition: transform 0.2s;
      animation: pulse 2s infinite;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }
    
    .powerup-visual:hover {
      transform: scale(1.1);
    }
    
    .powerup-label {
      font-size: 0.75rem;
      font-weight: bold;
      margin-top: 0.25rem;
      text-align: center;
      background-color: white;
      border-radius: 0.25rem;
      padding: 0.125rem 0.25rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* Special effects */
    .special-effect {
      position: absolute;
      font-size: 1.25rem;
      font-weight: bold;
      z-index: 50;
      text-shadow: 0 0 3px black;
      animation: bounce 1s infinite;
    }
    
    .combo-indicator {
      position: absolute;
      top: 33%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #facc15; /* yellow-400 */
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: bold;
      font-size: 1.5rem;
      animation: pulse 2s infinite;
      z-index: 50;
    }
    
    /* Particle */
    .particle {
      position: absolute;
      border-radius: 50%;
      transition: transform 0.05s;
    }
    
    /* Results screen */
    .results-chart {
      margin-bottom: 1.5rem;
    }
    
    .chart-container {
      position: relative;
      width: 16rem;
      height: 16rem;
      margin: 0 auto;
    }
    
    .chart-legend {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem 0.5rem;
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
    }
    
    .legend-color {
      width: 1rem;
      height: 1rem;
      margin-right: 0.25rem;
      border-radius: 0.25rem;
    }
    
    .results-score {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .results-score-item {
      font-size: 1.125rem;
      font-weight: bold;
    }
    
    .prediction-container {
      margin-bottom: 1.5rem;
    }
    
    .achievement {
      margin-bottom: 1.5rem;
      background-color: #fef9c3; /* yellow-100 */
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #facc15; /* yellow-400 */
    }
    
    .achievement-title {
      font-size: 1.125rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #a16207; /* yellow-700 */
    }
    
    .achievement-description {
      font-size: 0.875rem;
    }
    
    .results-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .results-buttons button {
      flex: 1;
      min-width: 120px;
    }
    
    .share-btn {
      background-color: #0ea5e9; /* sky-500 */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .share-btn:hover {
      background-color: #0284c7; /* sky-600 */
    }
    
    /* Enhanced sharing styles */
    .share-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    
    .share-preview {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    
    .share-preview-header {
      background-color: #f97316; /* orange-500 */
      color: white;
      padding: 0.75rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .share-preview-body {
      padding: 1rem;
      background-color: white;
    }
    
    .share-preview-footer {
      padding: 0.75rem;
      background-color: #f1f5f9; /* slate-100 */
      font-size: 0.875rem;
      color: #64748b; /* slate-500 */
      text-align: center;
    }
    
    .share-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    
    .share-modal-content {
      background-color: white;
      border-radius: 0.5rem;
      width: 100%;
      max-width: 30rem;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
    }
    
    .share-close-btn {
      background-color: #e2e8f0;
      color: #475569;
      border-radius: 9999px;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
    }
    
    /* Pie chart tooltip */
    .pie-chart-tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      pointer-events: none;
      z-index: 100;
      max-width: 200px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* Missing ingredients warning */
    .missing-ingredients {
      margin-top: 1rem;
      padding: 0.75rem;
      background-color: #fee2e2; /* red-100 */
      border: 1px solid #ef4444; /* red-500 */
      border-radius: 0.5rem;
      color: #b91c1c; /* red-700 */
    }
    
    .missing-ingredients-title {
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }
    
    /* Animations */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    /* SVG styles for vessel visualization */
    .vessel svg {
      width: 100%;
      height: 100%;
    }
    
    /* Screen visibility control */
    #instructionsScreen, #gameScreen, #resultsScreen {
      display: none;
    }
    
    .visible {
      display: block !important;
    }
    
    /* Mobile optimization */
    @media (max-width: 640px) {
      .taste-indicators {
        grid-template-columns: repeat(3, 1fr);
        row-gap: 0.75rem;
      }
      
      .hud-items-group {
        gap: 0.5rem;
      }
      
      .results-buttons {
        flex-direction: column;
      }
      
      .results-buttons button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>Ugadi Pachadi Maker</h1>
  
  <div class="container">
    <!-- Instructions Screen -->
    <div id="instructionsScreen" class="screen">
      <h2>How to Play</h2>
      <ul class="instructions">
        <li>Click ingredients on the conveyor belt to add them to your pachadi vessel</li>
        <li>Try to create a balanced mixture of all six tastes before time runs out</li>
        <li>Watch for special power-ups that can help you</li>
        <li>Chain together quick selections to build combo multipliers</li>
        <li>Your score and level affect your final prediction - reach higher levels by earning more points!</li>
        <li>Each taste represents a different emotion for the New Year:</li>
        <ul>
          <li><span class="font-medium">Sweet (Jaggery)</span> - Happiness</li>
          <li><span class="font-medium">Sour (Tamarind)</span> - Challenges</li>
          <li><span class="font-medium">Bitter (Neem)</span> - Difficulties</li>
          <li><span class="font-medium">Spicy (Chili)</span> - Excitement</li>
          <li><span class="font-medium">Salty (Salt)</span> - Tears</li>
          <li><span class="font-medium">Astringent (Raw Mango)</span> - Surprises</li>
        </ul>
        <li>The final balance will determine your prediction for the year!</li>
      </ul>
      
      <!-- Cultural context information -->
      <div class="cultural-context">
        <div class="cultural-context-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          About Ugadi
        </div>
        <p>Ugadi (also known as Yugadi) marks the beginning of the New Year for people in Karnataka, Andhra Pradesh, and Telangana. The preparation of Ugadi Pachadi is a significant tradition where six different tastes (sweet, sour, salty, bitter, pungent, and astringent) represent the mixture of different experiences in life. This symbolic dish reminds us that life is a mixture of different emotions and experiences, and we should be prepared to accept them all with equanimity.</p>
      </div>
      
      <!-- Difficulty selector -->
      <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Select Difficulty:</h3>
      <div class="difficulty-selector">
        <div id="easyBtn" class="difficulty-btn easy selected">
          Easy
          <div style="font-size: 0.75rem; font-weight: normal; margin-top: 0.25rem;">Slow Conveyor</div>
        </div>
        <div id="mediumBtn" class="difficulty-btn medium">
          Medium
          <div style="font-size: 0.75rem; font-weight: normal; margin-top: 0.25rem;">Normal Speed</div>
        </div>
        <div id="hardBtn" class="difficulty-btn hard">
          Hard
          <div style="font-size: 0.75rem; font-weight: normal; margin-top: 0.25rem;">Fast Conveyor</div>
        </div>
      </div>
      
      <button id="startGameBtn">Start Game</button>
    </div>
    
    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
      <!-- Game HUD -->
      <div class="game-hud">
        <div id="timeHud" class="hud-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1 text-orange-700">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span id="timeLeft" class="font-bold">30s</span>
        </div>
        
        <div class="hud-items-group">
          <div class="hud-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#eab308" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            <span id="currentScore" class="font-bold">0</span>
          </div>
          
          <div class="hud-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1">
              <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
              <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
            <span id="comboMultiplier" class="font-bold">x1</span>
          </div>
          
          <div class="hud-item">
            <span id="levelIndicator" class="font-bold">Lvl 1</span>
          </div>
          
          <div id="difficultyIndicator" class="hud-item difficulty-indicator medium">
            Medium
          </div>
        </div>
        
        <button id="showInstructionsBtn" class="p-2 bg-white rounded-full">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#c2410c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
        </button>
      </div>
      
      <!-- Active powerup indicator (hidden by default) -->
      <div id="activePowerup" class="active-powerup" style="display: none;">
        <svg id="powerupIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
        <span id="powerupName">Time Freeze</span>: <span id="powerupTimeLeft">5</span>s
      </div>
      
      <!-- Pachadi vessel -->
      <div class="vessel-container">
        <div class="vessel">
          <svg id="vesselSvg" viewBox="0 0 100 100">
            <!-- Base circle -->
            <circle cx="50" cy="50" r="48" fill="#e2e8f0" stroke="#ca8a04" stroke-width="1"></circle>
            
            <!-- Removed dividing lines -->
            
            <!-- Ingredient segments will be dynamically added here -->
            <g id="vesselContents"></g>
          </svg>
          
          <!-- Decorative border -->
          <div class="absolute inset-0 rounded-full border-4 border-yellow-400 opacity-30 pointer-events-none"></div>
        </div>
        
        <!-- Taste indicators -->
        <div class="taste-indicators">
          <!-- Will be dynamically filled -->
        </div>
      </div>
      
      <!-- Conveyor belt -->
      <div class="conveyor-belt">
        <!-- Decorative rollers -->
        <div class="conveyor-roller-left"></div>
        <div class="conveyor-roller-right"></div>
        
        <!-- Belt tracks -->
        <div class="conveyor-track-top"></div>
        <div class="conveyor-track-bottom"></div>
        
        <!-- Ingredients will be dynamically added here -->
        <div id="conveyorItems"></div>
      </div>
      
      <!-- Hint -->
      <div class="hint-text">
        Watch for special power-ups and try to build combos for higher scores!
      </div>
      
      <!-- Special effects container (for particles, combo indicators, etc.) -->
      <div id="specialEffects"></div>
    </div>
    
    <!-- Results Screen -->
    <div id="resultsScreen" class="screen" style="background-color: #f1f5f9;"> <!-- Changed from white to slate-100 -->
      <h2>Your Ugadi Prediction</h2>
      
      <!-- Pie chart visualization -->
      <div class="results-chart">
        <div class="chart-container">
          <svg id="resultsPieChart" viewBox="0 0 100 100" class="w-full h-full">
            <circle cx="50" cy="50" r="48" fill="#e2e8f0" stroke="#ca8a04" stroke-width="1" />
            
            <!-- Pie slices will be added dynamically -->
            <g id="pieSlices"></g>
            
            <!-- Center circle with "Year Ahead" text -->
            <circle cx="50" cy="50" r="15" fill="#FFF8E1" stroke="#ca8a04" stroke-width="0.5" />
            <text x="50" y="46" font-size="5" text-anchor="middle" font-weight="bold">Your</text>
            <text x="50" y="52" font-size="5" text-anchor="middle" font-weight="bold">Year</text>
            <text x="50" y="58" font-size="5" text-anchor="middle" font-weight="bold">Ahead</text>
          </svg>
          
          <!-- Tooltip for interactive pie chart -->
          <div id="pieChartTooltip" class="pie-chart-tooltip" style="display: none;"></div>
          
          <!-- Achievement badge if earned -->
          <div id="achievementBadge" style="display: none;" class="absolute -top-3 -right-3 bg-yellow-400 text-white p-2 rounded-full animate-pulse z-10">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="8" r="7"></circle>
              <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
          </div>
        </div>
        
        <div id="chartLegend" class="chart-legend">
          <!-- Will be dynamically filled -->
        </div>
      </div>
      
      <div class="results-score">
        <div id="finalScore" class="results-score-item">Score: 0</div>
        <div id="finalLevel" class="results-score-item">Level: 1</div>
      </div>
      
      <div class="prediction-container">
        <h3>Your Year Prediction:</h3>
        <p id="predictionText" class="text-lg"></p>
        
        <!-- Missing ingredients warning (hidden by default) -->
        <div id="missingIngredientsWarning" class="missing-ingredients" style="display: none;">
          <div class="missing-ingredients-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Missing Ingredients
          </div>
          <p id="missingIngredientsText"></p>
        </div>
      </div>
      
      <!-- Achievement display (hidden by default) -->
      <div id="achievementDisplay" class="achievement" style="display: none;">
        <h3 class="achievement-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="8" r="7"></circle>
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
          </svg>
          Achievement Unlocked: <span id="achievementName"></span>
        </h3>
        <p id="achievementCondition" class="achievement-description"></p>
      </div>
      
      <!-- Enhanced Share Preview -->
      <div id="sharePreview" class="share-preview" style="display: none;">
        <div class="share-preview-header">
          <span>Ugadi Prediction 2025</span>
          <span id="sharePreviewDate"></span>
        </div>
        <div class="share-preview-body">
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
            <div id="sharePredictionEmoji" style="font-size: 2rem;">ðŸŒŸ</div>
            <div>
              <div id="sharePredictionTitle" style="font-weight: bold; margin-bottom: 0.25rem;"></div>
              <div id="sharePredictionText" style="font-size: 0.875rem;"></div>
            </div>
          </div>
          <div id="shareStatsContainer" style="display: flex; justify-content: space-between; margin-top: 0.75rem; font-size: 0.875rem;">
            <div>Score: <span id="shareScore"></span></div>
            <div>Level: <span id="shareLevel"></span></div>
            <div id="shareAchievement" style="color: #ca8a04;"></div>
          </div>
        </div>
        <div class="share-preview-footer">
          Created with Ugadi Pachadi Maker â€¢ Share your own at ugadipachadi.com
        </div>
      </div>
      
      <div class="results-buttons">
        <button id="playAgainBtn" class="flex-1">Play Again</button>
        <button id="resultsInstructionsBtn" class="secondary flex-1">Instructions</button>
        <button id="shareResultsBtn" class="share-btn flex-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
          Share Results
        </button>
      </div>
      
      <!-- Share Modal -->
      <div id="shareModal" class="share-modal" style="display: none;">
        <div class="share-modal-content">
          <h3>Share Your Prediction</h3>
          <div class="share-close-btn" id="closeShareBtn">âœ•</div>
          
          <div class="share-preview" style="margin: 1rem 0;">
            <div class="share-preview-header">
              <span>Ugadi Prediction 2025</span>
              <span id="modalShareDate"></span>
            </div>
            <div class="share-preview-body">
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                <div id="modalShareEmoji" style="font-size: 2rem;">ðŸŒŸ</div>
                <div>
                  <div id="modalShareTitle" style="font-weight: bold; margin-bottom: 0.25rem;"></div>
                  <div id="modalShareText" style="font-size: 0.875rem;"></div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; margin-top: 0.75rem; font-size: 0.875rem;">
                <div>Score: <span id="modalShareScore"></span></div>
                <div>Level: <span id="modalShareLevel"></span></div>
                <div id="modalShareAchievement" style="color: #ca8a04;"></div>
              </div>
            </div>
            <div class="share-preview-footer">
              Created with Ugadi Pachadi Maker â€¢ Share your own at ugadipachadi.com
            </div>
          </div>
          
          <p style="margin-bottom: 1rem;">Share your Ugadi prediction with friends and family!</p>
          
          <div class="share-options">
            <button id="shareTwitterBtn" class="share-btn" style="background-color: #1DA1F2;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
              </svg>
              Share on Twitter
            </button>
            <button id="shareFacebookBtn" class="share-btn" style="background-color: #4267B2;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
              </svg>
              Share on Facebook
            </button>
            <button id="shareWhatsappBtn" class="share-btn" style="background-color: #25D366;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
              </svg>
              Share on WhatsApp
            </button>
            <button id="shareCopyBtn" class="share-btn" style="background-color: #6b7280;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy to Clipboard
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Special effect overlay (for combo indicator, powerups, etc.) -->
    <div id="effectsOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50;"></div>
  </div>

  <script>
    // Game state variables
    let gameStarted = false;
    let gameOver = false;
    let timeLeft = 30;
    let currentScore = 0;
    let level = 1;
    let streak = 0;
    let comboMultiplier = 1;
    let showCombo = false;
    let activePowerup = null;
    let powerupTimeLeft = 0;
    let particles = [];
    let missingIngredients = [];
    let penaltyApplied = 0;
    let gameDifficulty = 'medium'; // Default difficulty
    
    // Vessel contents
    let vessel = {
      sweet: 0,
      sour: 0, 
      bitter: 0,
      spicy: 0,
      salty: 0,
      astringent: 0
    };
    
    // Game result
    let prediction = '';
    let achievement = null;
    
    // Conveyor items
    let visibleIngredients = [];
    let specialItems = [];
    
    // Timers
    let gameTimer;
    let conveyorTimer;
    let particleTimer;
    let powerupTimer;
    
    // Ingredients data with visuals, tastes and placeholder images
    const ingredients = [
      { name: 'Jaggery', taste: 'sweet', color: '#D2691E', shape: 'square', emotion: 'happiness', image: '/api/placeholder/100/100?text=Jaggery' },
      { name: 'Tamarind', taste: 'sour', color: '#8B0000', shape: 'oval', emotion: 'challenges', image: '/api/placeholder/100/100?text=Tamarind' },
      { name: 'Neem Flower', taste: 'bitter', color: '#32CD32', shape: 'circle', emotion: 'difficulties', image: '/api/placeholder/100/100?text=Neem' },
      { name: 'Green Chili', taste: 'spicy', color: '#006400', shape: 'long', emotion: 'excitement', image: '/api/placeholder/100/100?text=Chili' },
      { name: 'Salt', taste: 'salty', color: '#F8F8FF', shape: 'crystal', emotion: 'tears', image: '/api/placeholder/100/100?text=Salt' },
      { name: 'Raw Mango', taste: 'astringent', color: '#FFD700', shape: 'slice', emotion: 'surprises', image: '/api/placeholder/100/100?text=Mango' }
    ];
    
    // Power-ups
    const powerups = [
      { 
        name: 'Time Freeze', 
        color: '#1E90FF', 
        effect: 'Freezes conveyor belt for 5 seconds',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>'
      },
      { 
        name: 'Double Points', 
        color: '#FFD700', 
        effect: 'Doubles points for 10 seconds',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>'
      },
      { 
        name: 'Balance Boost', 
        color: '#9932CC', 
        effect: 'Adds 1 to lowest ingredient',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>'
      }
    ];
    
    // Achievements
    const achievements = [
      { 
        name: 'Perfect Balance', 
        condition: 'Create a perfectly balanced pachadi',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>'
      },
      { 
        name: 'Speed Mixer', 
        condition: 'Complete a pachadi in under 30 seconds',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>'
      },
      { 
        name: 'Combo Master', 
        condition: 'Achieve a 5x combo multiplier',
        icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>'
      }
    ];
    
    // DOM elements
    const instructionsScreen = document.getElementById('instructionsScreen');
    const gameScreen = document.getElementById('gameScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const startGameBtn = document.getElementById('startGameBtn');
    const showInstructionsBtn = document.getElementById('showInstructionsBtn');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const resultsInstructionsBtn = document.getElementById('resultsInstructionsBtn');
    const shareResultsBtn = document.getElementById('shareResultsBtn');
    const timeLeft_el = document.getElementById('timeLeft');
    const currentScore_el = document.getElementById('currentScore');
    const comboMultiplier_el = document.getElementById('comboMultiplier');
    const levelIndicator_el = document.getElementById('levelIndicator');
    const activePowerup_el = document.getElementById('activePowerup');
    const powerupIcon_el = document.getElementById('powerupIcon');
    const powerupName_el = document.getElementById('powerupName');
    const powerupTimeLeft_el = document.getElementById('powerupTimeLeft');
    const timeHud_el = document.getElementById('timeHud');
    const specialEffects_el = document.getElementById('specialEffects');
    const conveyorItems_el = document.getElementById('conveyorItems');
    const vesselContents_el = document.getElementById('vesselContents');
    const tasteIndicators_el = document.querySelector('.taste-indicators');
    const effectsOverlay_el = document.getElementById('effectsOverlay');
    const finalScore_el = document.getElementById('finalScore');
    const finalLevel_el = document.getElementById('finalLevel');
    const predictionText_el = document.getElementById('predictionText');
    const achievementDisplay_el = document.getElementById('achievementDisplay');
    const achievementName_el = document.getElementById('achievementName');
    const achievementCondition_el = document.getElementById('achievementCondition');
    const achievementBadge_el = document.getElementById('achievementBadge');
    const pieSlices_el = document.getElementById('pieSlices');
    const chartLegend_el = document.getElementById('chartLegend');
    
    // Initialize the game
    function init() {
      // Show instructions screen at start
      instructionsScreen.classList.add('visible');
      
      // Initialize taste indicators
      updateTasteIndicators();
      
      // Set up event listeners
      startGameBtn.addEventListener('click', startGame);
      showInstructionsBtn.addEventListener('click', showInstructions);
      playAgainBtn.addEventListener('click', startGame);
      resultsInstructionsBtn.addEventListener('click', showInstructions);
      shareResultsBtn.addEventListener('click', showShareModal);
      
      // Difficulty selector event listeners
      document.getElementById('easyBtn').addEventListener('click', () => setDifficulty('easy'));
      document.getElementById('mediumBtn').addEventListener('click', () => setDifficulty('medium'));
      document.getElementById('hardBtn').addEventListener('click', () => setDifficulty('hard'));
      
      // Share modal close button
      document.getElementById('closeShareBtn').addEventListener('click', closeShareModal);
      
      // Share options
      document.getElementById('shareTwitterBtn').addEventListener('click', shareTwitter);
      document.getElementById('shareFacebookBtn').addEventListener('click', shareFacebook);
      document.getElementById('shareWhatsappBtn').addEventListener('click', shareWhatsApp);
      document.getElementById('shareCopyBtn').addEventListener('click', copyToClipboard);
      
      // Set current date for share preview
      const currentDate = new Date().toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric' 
      });
      document.getElementById('sharePreviewDate').textContent = currentDate;
      document.getElementById('modalShareDate').textContent = currentDate;
    }
    
    // Set difficulty level
    function setDifficulty(difficulty) {
      // Remove selected class from all buttons
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // Add selected class to chosen difficulty
      document.getElementById(difficulty + 'Btn').classList.add('selected');
      
      // Store difficulty
      gameDifficulty = difficulty;
    }
    
    // Start the game
    function startGame() {
      // Reset game state
      gameStarted = true;
      gameOver = false;
      
      // Set standard time across all difficulties
      timeLeft = 35; // Same time limit for all difficulties
      
      currentScore = 0;
      level = 1;
      streak = 0;
      comboMultiplier = 1;
      activePowerup = null;
      powerupTimeLeft = 0;
      particles = [];
      missingIngredients = [];
      penaltyApplied = 0;
      
      vessel = {
        sweet: 0,
        sour: 0, 
        bitter: 0,
        spicy: 0,
        salty: 0,
        astringent: 0
      };
      
      prediction = '';
      achievement = null;
      
      visibleIngredients = [];
      specialItems = [];
      
      // Clear any existing timers
      clearInterval(gameTimer);
      clearInterval(conveyorTimer);
      clearInterval(particleTimer);
      clearInterval(powerupTimer);
      
      // Clear UI elements
      timeLeft_el.textContent = timeLeft + 's';
      currentScore_el.textContent = '0';
      comboMultiplier_el.textContent = 'x1';
      levelIndicator_el.textContent = 'Lvl 1';
      activePowerup_el.style.display = 'none';
      timeHud_el.classList.remove('active');
      conveyorItems_el.innerHTML = '';
      vesselContents_el.innerHTML = '';
      effectsOverlay_el.innerHTML = '';
      
      // Update difficulty indicator
      const difficultyIndicator = document.getElementById('difficultyIndicator');
      difficultyIndicator.className = 'hud-item difficulty-indicator ' + gameDifficulty;
      difficultyIndicator.textContent = gameDifficulty.charAt(0).toUpperCase() + gameDifficulty.slice(1);
      
      // Update taste indicators
      updateTasteIndicators();
      
      // Show game screen
      instructionsScreen.classList.remove('visible');
      resultsScreen.classList.remove('visible');
      gameScreen.classList.add('visible');
      
      // Start game timers
      startGameTimer();
      startConveyorBelt();
    }
    
    // Show instructions
    function showInstructions() {
      // Clear any existing timers
      clearInterval(gameTimer);
      clearInterval(conveyorTimer);
      clearInterval(particleTimer);
      clearInterval(powerupTimer);
      
      // Reset game state
      gameStarted = false;
      gameOver = false;
      
      // Show instructions screen
      gameScreen.classList.remove('visible');
      resultsScreen.classList.remove('visible');
      instructionsScreen.classList.add('visible');
    }
    
    // Start game timer
    function startGameTimer() {
      gameTimer = setInterval(() => {
        if (activePowerup !== 'Time Freeze') {
          timeLeft--;
          timeLeft_el.textContent = timeLeft + 's';
          
          if (timeLeft <= 0) {
            endGame();
          }
        }
      }, 1000);
    }
    
    // Start conveyor belt
    function startConveyorBelt() {
      // Set conveyor speed based on difficulty
      let baseSpeed = 800; // Default interval for medium difficulty (ms)
      let ingredientSpeed = 1; // Default speed multiplier for ingredients
      
      switch(gameDifficulty) {
        case 'easy':
          baseSpeed = 1200; // Slower item generation
          ingredientSpeed = 0.7; // Slower movement
          break;
        case 'hard':
          baseSpeed = 600; // Faster item generation
          ingredientSpeed = 1.8; // Much faster movement
          break;
        default: // medium
          baseSpeed = 800;
          ingredientSpeed = 1;
      }
      
      conveyorTimer = setInterval(() => {
        // Add new items on the conveyor regardless of powerup state
        addNewConveyorItems(ingredientSpeed);
        
        // Always move existing items (even during time freeze)
        moveConveyorItems();
        
        // Gradually decrease streak if no selections
        streak = Math.max(0, streak - 0.1);
      }, baseSpeed - (level * 50)); // Speed up with level
    }
    
    // Add new items to the conveyor
    function addNewConveyorItems(ingredientSpeed) {
      // Find missing ingredients
      const missingTastes = Object.keys(vessel).filter(taste => vessel[taste] === 0);
      
      // Calculate game progress percentage (0-100%)
      const gameProgress = ((35 - timeLeft) / 35) * 100;
      
      // Increase chance of missing ingredients appearing as game progresses
      let missingIngredientChance = 0.3; // Base 30% chance
      
      // In second half of game, increase chance of missing ingredients
      if (gameProgress > 50) {
        // Scale from 30% at midpoint to 70-90% near end, based on difficulty
        const maxChance = gameDifficulty === 'easy' ? 0.9 : (gameDifficulty === 'hard' ? 0.7 : 0.8);
        missingIngredientChance = 0.3 + ((gameProgress - 50) / 50) * (maxChance - 0.3);
        
        // If time is critically low (last 20% of game time), further increase chance
        if (gameProgress > 80) {
          missingIngredientChance += 0.1;
        }
      }
      
      // Random chance to spawn powerup (10%)
      const spawnPowerup = Math.random() < 0.1 && specialItems.length < 1;
      
      // Check if there's enough space for a new item
      const checkPosition = (newPosition, existingItems) => {
        // Ensure items are at least 15% apart on the conveyor
        const minDistance = 15;
        return !existingItems.some(item => 
          Math.abs(item.position - newPosition) < minDistance
        );
      };
      
      // Find a valid position that doesn't overlap
      const findValidPosition = () => {
        const allItems = [...visibleIngredients, ...specialItems];
        let attempts = 0;
        let position;
        
        do {
          position = Math.floor(Math.random() * 80) + 10;
          attempts++;
        } while (!checkPosition(position, allItems) && attempts < 10);
        
        return position;
      };
      
      if (spawnPowerup) {
        // If missing ingredients and in second half of game, prioritize Balance Boost
        if (missingTastes.length > 0 && gameProgress > 50) {
          const powerupIndex = powerups.findIndex(p => p.name === 'Balance Boost');
          if (powerupIndex !== -1) {
            const position = findValidPosition();
            
            // Only add if we found a valid position
            if (checkPosition(position, [...visibleIngredients, ...specialItems])) {
              const powerupId = 'powerup-' + Date.now();
              specialItems.push({ 
                id: powerupId, 
                type: powerups[powerupIndex],
                position: position
              });
              
              // Create DOM element for powerup
              const powerupElement = document.createElement('div');
              powerupElement.id = powerupId;
              powerupElement.className = 'powerup';
              powerupElement.style.left = position + '%';
              
              powerupElement.innerHTML = `
                <div class="powerup-visual" style="background-color: ${powerups[powerupIndex].color}; box-shadow: 0 0 12px ${powerups[powerupIndex].color}">
                  ${powerups[powerupIndex].icon}
                </div>
                <div class="powerup-label">${powerups[powerupIndex].name}</div>
              `;
              
              // Add click handler
              powerupElement.addEventListener('click', () => {
                selectPowerup(powerupId, position);
              });
              
              conveyorItems_el.appendChild(powerupElement);
            }
          }
        } else {
          // Regular random powerup
          const randomPowerup = powerups[Math.floor(Math.random() * powerups.length)];
          const position = findValidPosition();
          
          // Only add if we found a valid position
          if (checkPosition(position, [...visibleIngredients, ...specialItems])) {
            const powerupId = 'powerup-' + Date.now();
            specialItems.push({ 
              id: powerupId, 
              type: randomPowerup,
              position: position
            });
            
            // Create DOM element for powerup
            const powerupElement = document.createElement('div');
            powerupElement.id = powerupId;
            powerupElement.className = 'powerup';
            powerupElement.style.left = position + '%';
            
            powerupElement.innerHTML = `
              <div class="powerup-visual" style="background-color: ${randomPowerup.color}; box-shadow: 0 0 12px ${randomPowerup.color}">
                ${randomPowerup.icon}
              </div>
              <div class="powerup-label">${randomPowerup.name}</div>
            `;
            
            // Add click handler
            powerupElement.addEventListener('click', () => {
              selectPowerup(powerupId, position);
            });
            
            conveyorItems_el.appendChild(powerupElement);
          }
        }
      }
      else if (visibleIngredients.length < 5) {
        let availableIngredients = [...ingredients];
        let selectedIngredient;
        
        // If missing ingredients exist and random chance hits, prioritize them
        if (missingTastes.length > 0 && Math.random() < missingIngredientChance) {
          // Select a random missing taste
          const randomMissingTaste = missingTastes[Math.floor(Math.random() * missingTastes.length)];
          selectedIngredient = ingredients.find(ing => ing.taste === randomMissingTaste);
          
          // Add subtle highlight to indicate it's a missing ingredient
          const position = findValidPosition();
          
          // Only add if we found a valid position
          if (checkPosition(position, [...visibleIngredients, ...specialItems])) {
            const ingredientId = 'ingredient-' + Date.now();
            visibleIngredients.push({ 
              ...selectedIngredient, 
              id: ingredientId, 
              position: position,
              speed: 1 + (level * 0.2), // Speed increases with level
              isMissing: true // Mark as missing ingredient
            });
            
            // Create DOM element for ingredient with subtle indication it's missing
            const ingredientElement = document.createElement('div');
            ingredientElement.id = ingredientId;
            ingredientElement.className = 'ingredient';
            ingredientElement.style.left = position + '%';
            
            // Use image with fallback to shape, add subtle glow for missing ingredient
            ingredientElement.innerHTML = `
              <div class="ingredient-visual" style="background-color: ${selectedIngredient.color}; box-shadow: 0 0 8px ${selectedIngredient.color}">
                <img src="${selectedIngredient.image}" alt="${selectedIngredient.name}" class="ingredient-img" onerror="this.style.display='none'; this.parentNode.querySelector('.ingredient-shape').style.display='block';" />
                <div class="ingredient-shape ${selectedIngredient.shape}" style="display: none;"></div>
              </div>
              <div class="ingredient-label">${selectedIngredient.name}</div>
            `;
            
            // Add click handler
            ingredientElement.addEventListener('click', () => {
              selectIngredient(ingredientId, position);
            });
            
            conveyorItems_el.appendChild(ingredientElement);
          }
        } else {
          // Higher chance for lowest-count ingredients as level increases
          const minValue = Math.min(...Object.values(vessel).filter(v => v > 0) || [0]);
          const minIngredients = ingredients.filter(ing => vessel[ing.taste] === minValue);
          
          // Level-based difficulty adjustment
          if (level >= 2 && Math.random() < 0.3) {
            availableIngredients = minIngredients.length > 0 ? minIngredients : availableIngredients;
          }
          
          const randomIngredient = availableIngredients[Math.floor(Math.random() * availableIngredients.length)];
          const position = findValidPosition();
          
          // Only add if we found a valid position
          if (checkPosition(position, [...visibleIngredients, ...specialItems])) {
            const ingredientId = 'ingredient-' + Date.now();
            visibleIngredients.push({ 
              ...randomIngredient, 
              id: ingredientId, 
              position: position,
              speed: ingredientSpeed + (level * 0.2) // Speed based on difficulty and level
            });
            
            // Create DOM element for ingredient
            const ingredientElement = document.createElement('div');
            ingredientElement.id = ingredientId;
            ingredientElement.className = 'ingredient';
            ingredientElement.style.left = position + '%';
            
            // Use image with fallback to shape
            ingredientElement.innerHTML = `
              <div class="ingredient-visual" style="background-color: ${randomIngredient.color}">
                <img src="${randomIngredient.image}" alt="${randomIngredient.name}" class="ingredient-img" onerror="this.style.display='none'; this.parentNode.querySelector('.ingredient-shape').style.display='block';" />
                <div class="ingredient-shape ${randomIngredient.shape}" style="display: none;"></div>
              </div>
              <div class="ingredient-label">${randomIngredient.name}</div>
            `;
            
            // Add click handler
            ingredientElement.addEventListener('click', () => {
              selectIngredient(ingredientId, position);
            });
            
            conveyorItems_el.appendChild(ingredientElement);
          }
        }
      }
    }
    
    // Move items along the conveyor
    function moveConveyorItems() {
      // Base movement speed multiplier based on difficulty
      let baseSpeedMultiplier = 1;
      switch(gameDifficulty) {
        case 'easy':
          baseSpeedMultiplier = 0.7;
          break;
        case 'hard':
          baseSpeedMultiplier = 1.8;
          break;
      }
      
      // Always move ingredients, even during Time Freeze
      visibleIngredients.forEach(ingredient => {
        // Use individual ingredient speed if available, otherwise use default speed based on difficulty
        const speed = ingredient.speed || (baseSpeedMultiplier + (level * 0.2));
        ingredient.position -= speed * 5;
        
        const element = document.getElementById(ingredient.id);
        if (element) {
          if (ingredient.position > -10) {
            element.style.left = ingredient.position + '%';
          } else {
            // Remove if off screen
            element.remove();
          }
        }
      });
      
      // Filter out off-screen ingredients
      visibleIngredients = visibleIngredients.filter(ing => ing.position > -10);
      
      // Always move powerups, even during Time Freeze
      specialItems.forEach(item => {
        // Apply the same speed multiplier to powerups based on difficulty
        const powerupSpeed = baseSpeedMultiplier * 5;
        item.position -= powerupSpeed;
        
        const element = document.getElementById(item.id);
        if (element) {
          if (item.position > -10) {
            element.style.left = item.position + '%';
          } else {
            // Remove if off screen
            element.remove();
          }
        }
      });
      
      // Filter out off-screen powerups
      specialItems = specialItems.filter(item => item.position > -10);
    }
    
    // Select an ingredient
    function selectIngredient(id, position) {
      const ingredientIndex = visibleIngredients.findIndex(ing => ing.id === id);
      if (ingredientIndex === -1) return;
      
      const ingredient = visibleIngredients[ingredientIndex];
      
      // Add to vessel
      vessel[ingredient.taste]++;
      
      // Create particle effect
      createParticleEffect(position, 60, ingredient.color);
      
      // Remove from conveyor
      visibleIngredients.splice(ingredientIndex, 1);
      const element = document.getElementById(id);
      if (element) element.remove();
      
      // Update combo system
      streak++;
      if (streak > 0 && streak % 3 === 0) {
        const newMultiplier = Math.min(5, comboMultiplier + 1);
        comboMultiplier = newMultiplier;
        comboMultiplier_el.textContent = 'x' + comboMultiplier;
        
        // Show combo indicator
        showComboIndicator();
        
        // Add a small time bonus for combos
        timeLeft = Math.min(30, timeLeft + 1);
        timeLeft_el.textContent = timeLeft + 's';
      }
      
      // Update score
      const pointValue = 10 * comboMultiplier;
      currentScore += pointValue;
      currentScore_el.textContent = currentScore;
      
      // Show floating score
      showSpecialEffect('score', '+' + pointValue, position, ingredient.color);
      
      // Update vessel visualization
      updateVesselContents();
      
      // Update taste indicators
      updateTasteIndicators();
      
      // Check for level up
      checkLevelUp();
    }
    
    // Select a powerup
    function selectPowerup(id, position) {
      const powerupIndex = specialItems.findIndex(item => item.id === id);
      if (powerupIndex === -1) return;
      
      const powerup = specialItems[powerupIndex];
      
      // Remove from conveyor
      specialItems.splice(powerupIndex, 1);
      const element = document.getElementById(id);
      if (element) element.remove();
      
      // Create particle effect
      createParticleEffect(position, 60, powerup.type.color);
      
      // Apply powerup effect
      activePowerup = powerup.type.name;
      
      if (powerup.type.name === 'Time Freeze') {
        powerupTimeLeft = 5;
        activePowerup_el.style.display = 'flex';
        powerupIcon_el.innerHTML = powerup.type.icon;
        powerupName_el.textContent = powerup.type.name;
        powerupTimeLeft_el.textContent = powerupTimeLeft;
        timeHud_el.classList.add('active');
        
        // Display special effect for Time Freeze
        showSpecialEffect('powerup', 'Time Freeze!', 50, '#1E90FF');
        
        // Start powerup timer
        startPowerupTimer();
      } else if (powerup.type.name === 'Double Points') {
        powerupTimeLeft = 10;
        activePowerup_el.style.display = 'flex';
        powerupIcon_el.innerHTML = powerup.type.icon;
        powerupName_el.textContent = powerup.type.name;
        powerupTimeLeft_el.textContent = powerupTimeLeft;
        
        // Display special effect
        showSpecialEffect('powerup', 'Double Points!', 50, '#FFD700');
        
        // Start powerup timer
        startPowerupTimer();
      } else if (powerup.type.name === 'Balance Boost') {
        // Find lowest ingredient
        const values = Object.values(vessel).filter(v => v > 0);
        const minValue = values.length > 0 ? Math.min(...values) : 0;
        const minTastes = Object.keys(vessel).filter(key => vessel[key] === minValue);
        
        if (minTastes.length > 0) {
          const tasteToBoost = minTastes[Math.floor(Math.random() * minTastes.length)];
          vessel[tasteToBoost]++;
          
          // Update vessel visualization
          updateVesselContents();
          
          // Update taste indicators
          updateTasteIndicators();
          
          // Display special effect
          showSpecialEffect('powerup', 'Balance Boost!', 50, '#9932CC');
        }
      }
      
      // Update score
      currentScore += 25;
      currentScore_el.textContent = currentScore;
    }
    
    // Start powerup timer
    function startPowerupTimer() {
      clearInterval(powerupTimer);
      
      powerupTimer = setInterval(() => {
        powerupTimeLeft--;
        powerupTimeLeft_el.textContent = powerupTimeLeft;
        
        if (powerupTimeLeft <= 0) {
          clearInterval(powerupTimer);
          activePowerup = null;
          activePowerup_el.style.display = 'none';
          timeHud_el.classList.remove('active');
        }
      }, 1000);
    }
    
    // Create particle effect
    function createParticleEffect(x, y, color) {
      // Create multiple particles
      for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2;
        const speed = 1 + Math.random() * 2;
        const particle = {
          id: 'particle-' + Date.now() + '-' + i,
          x,
          y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          color,
          size: 4 + Math.random() * 4,
          life: 30 + Math.random() * 30
        };
        
        particles.push(particle);
        
        // Create DOM element for particle
        const particleElement = document.createElement('div');
        particleElement.id = particle.id;
        particleElement.className = 'particle';
        particleElement.style.left = particle.x + '%';
        particleElement.style.top = particle.y + '%';
        particleElement.style.width = particle.size + 'px';
        particleElement.style.height = particle.size + 'px';
        particleElement.style.backgroundColor = particle.color;
        particleElement.style.opacity = particle.life / 60;
        particleElement.style.transform = 'scale(' + (particle.life / 30) + ')';
        
        effectsOverlay_el.appendChild(particleElement);
      }
      
      // Start particle animation if not already running
      if (!particleTimer) {
        startParticleAnimation();
      }
    }
    
    // Animate particles
    function startParticleAnimation() {
      particleTimer = setInterval(() => {
        let hasActiveParticles = false;
        
        particles.forEach(particle => {
          particle.x += particle.vx;
          particle.y += particle.vy;
          particle.life -= 1;
          particle.size *= 0.95;
          
          const element = document.getElementById(particle.id);
          if (element) {
            if (particle.life > 0) {
              element.style.left = particle.x + '%';
              element.style.top = particle.y + '%';
              element.style.width = particle.size + 'px';
              element.style.height = particle.size + 'px';
              element.style.opacity = particle.life / 60;
              element.style.transform = 'scale(' + (particle.life / 30) + ')';
              hasActiveParticles = true;
            } else {
              element.remove();
            }
          }
        });
        
        // Remove dead particles
        particles = particles.filter(p => p.life > 0);
        
        // Stop animation if no active particles
        if (!hasActiveParticles) {
          clearInterval(particleTimer);
          particleTimer = null;
        }
      }, 16);
    }
    
    // Show combo indicator
    function showComboIndicator() {
      // Create combo indicator
      const comboElement = document.createElement('div');
      comboElement.className = 'combo-indicator';
      comboElement.textContent = comboMultiplier + 'X Combo!';
      
      effectsOverlay_el.appendChild(comboElement);
      
      // Remove after animation
      setTimeout(() => {
        comboElement.remove();
      }, 1500);
    }
    
    // Show special effect (score, powerup, etc.)
    function showSpecialEffect(type, value, position, color) {
      const effectElement = document.createElement('div');
      effectElement.className = 'special-effect';
      effectElement.textContent = value;
      effectElement.style.left = position + '%';
      effectElement.style.top = '40%';
      effectElement.style.color = color || '#FFD700';
      
      effectsOverlay_el.appendChild(effectElement);
      
      // Remove after animation
      setTimeout(() => {
        effectElement.remove();
      }, 1000);
    }
    
    // Update vessel contents visualization
    function updateVesselContents() {
      // Clear existing content
      vesselContents_el.innerHTML = '';
      
      // Get total amount of ingredients
      const totalAmount = Object.values(vessel).reduce((a, b) => a + b, 0) || 1;
      
      // Add segments for each taste
      Object.entries(vessel).forEach(([taste, amount], index) => {
        if (amount === 0) return;
        
        const ingredient = ingredients.find(i => i.taste === taste);
        const percentage = amount / totalAmount;
        const radius = 50 * percentage;
        
        // Calculate position at 60Â° intervals
        const angle = (index * 60);
        const angleRad = (angle - 90) * Math.PI / 180;
        const x = 50 + 40 * Math.cos(angleRad);
        const y = 50 + 40 * Math.sin(angleRad);
        
        // Create circle segment
        const segment = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', x);
        circle.setAttribute('cy', y);
        circle.setAttribute('r', 5 + radius);
        circle.setAttribute('fill', ingredient.color);
        circle.setAttribute('opacity', '0.8');
        
        // Animation
        const animate = document.createElementNS('http://www.w3.org/2000/svg', 'animate');
        animate.setAttribute('attributeName', 'r');
        animate.setAttribute('values', `${radius};${5 + radius}`);
        animate.setAttribute('dur', '0.5s');
        animate.setAttribute('repeatCount', '1');
        circle.appendChild(animate);
        
        // Text
        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        text.setAttribute('x', x);
        text.setAttribute('y', y);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('dominant-baseline', 'middle');
        text.setAttribute('fill', ['sweet', 'sour', 'bitter', 'spicy'].includes(taste) ? 'white' : 'black');
        text.setAttribute('font-size', '10');
        text.setAttribute('font-weight', 'bold');
        text.textContent = amount;
        
        segment.appendChild(circle);
        segment.appendChild(text);
        vesselContents_el.appendChild(segment);
      });
    }
    
    // Update taste indicators
    function updateTasteIndicators() {
      // Clear existing indicators
      tasteIndicators_el.innerHTML = '';
      
      // Add indicator for each taste
      ingredients.forEach(ingredient => {
        const tasteElement = document.createElement('div');
        tasteElement.className = 'taste-indicator';
        
        const valueElement = document.createElement('div');
        valueElement.className = 'taste-value';
        valueElement.style.backgroundColor = ingredient.color;
        valueElement.style.color = ['sweet', 'sour', 'bitter', 'spicy'].includes(ingredient.taste) ? 'white' : 'black';
        valueElement.textContent = vessel[ingredient.taste];
        
        const nameElement = document.createElement('div');
        nameElement.className = 'taste-name';
        nameElement.textContent = ingredient.name;
        
        tasteElement.appendChild(valueElement);
        tasteElement.appendChild(nameElement);
        tasteIndicators_el.appendChild(tasteElement);
      });
    }
    
    // Check for level up
    function checkLevelUp() {
      if (currentScore >= level * 100 && level < 5) {
        level++;
        levelIndicator_el.textContent = 'Lvl ' + level;
        
        // Celebratory effect
        showSpecialEffect('levelUp', 'Level ' + level + '!', 50, '#22c55e');
      }
    }
    
    // End the game
    function endGame() {
      gameOver = true;
      clearInterval(gameTimer);
      
      // Determine prediction
      prediction = determinePrediction();
      
      // Update results screen
      finalScore_el.textContent = 'Score: ' + currentScore;
      finalLevel_el.textContent = 'Level: ' + level;
      predictionText_el.textContent = prediction;
      
      // Update pie chart
      updateResultsPieChart();
      
      // Show achievement if earned
      if (achievement) {
        achievementDisplay_el.style.display = 'block';
        achievementName_el.textContent = achievement.name;
        achievementCondition_el.textContent = achievement.condition;
        achievementBadge_el.style.display = 'block';
      } else {
        achievementDisplay_el.style.display = 'none';
        achievementBadge_el.style.display = 'none';
      }
      
      // Update share preview
      updateSharePreview();
      
      // Show results screen
      gameScreen.classList.remove('visible');
      resultsScreen.classList.add('visible');
    }
    
    // Determine outcome/prediction based on balance of tastes
    function determinePrediction() {
      const values = Object.values(vessel);
      const max = Math.max(...values);
      const min = Math.min(...values.filter(v => v > 0) || [0]);
      const maxTastes = Object.keys(vessel).filter(key => vessel[key] === max);
      
      // Check for missing ingredients
      missingIngredients = [];
      ingredients.forEach(ingredient => {
        if (vessel[ingredient.taste] === 0) {
          missingIngredients.push(ingredient);
        }
      });
      
      // Apply penalty for missing ingredients (50 points per missing ingredient)
      if (missingIngredients.length > 0) {
        penaltyApplied = missingIngredients.length * 50;
        currentScore = Math.max(0, currentScore - penaltyApplied);
      }
      
      let predictionText = '';
      
      // Check for perfect balance
      if (values.every(v => v === values[0]) && values[0] > 0) {
        predictionText = "Perfectly balanced! You'll experience all of life's emotions in harmony this year. This is a rare and auspicious sign!";
        achievement = achievements[0];
      } else if (max - min <= 1 && min > 0) {
        predictionText = "Nearly balanced! Your year will have a harmonious blend of all experiences, with nothing overwhelming you.";
      } else if (maxTastes.includes('sweet')) {
        predictionText = "This year will bring you much happiness and joy! Sweet experiences will dominate your year, bringing contentment and satisfaction.";
      } else if (maxTastes.includes('sour')) {
        predictionText = "You'll face interesting challenges that will help you grow this year. These experiences may test you but will ultimately lead to personal growth.";
      } else if (maxTastes.includes('bitter')) {
        predictionText = "You may encounter some difficulties, but they will make you stronger. Through perseverance, you'll discover your inner strength.";
      } else if (maxTastes.includes('spicy')) {
        predictionText = "An exciting year awaits with plenty of thrills and adventures! Expect passion and intensity in your experiences.";
      } else if (maxTastes.includes('salty')) {
        predictionText = "Some emotional moments may bring tears, but they will cleanse your soul. These experiences will deepen your emotional wisdom.";
      } else if (maxTastes.includes('astringent')) {
        predictionText = "Expect many surprises and unexpected turns this year! Life will keep you on your toes with unexpected opportunities.";
      }
      
      // Check for speed achievement
      if (timeLeft > 30) {
        achievement = achievements[1];
      }
      
      // Check for combo achievement
      if (comboMultiplier >= 5) {
        achievement = achievements[2];
      }
      
      // Show missing ingredients warning if any
      const missingIngredientsWarning = document.getElementById('missingIngredientsWarning');
      const missingIngredientsText = document.getElementById('missingIngredientsText');
      
      if (missingIngredients.length > 0) {
        missingIngredientsWarning.style.display = 'block';
        
        const missingNames = missingIngredients.map(ing => ing.name).join(', ');
        const penaltyText = penaltyApplied > 0 ? ` A penalty of ${penaltyApplied} points has been applied.` : '';
        
        missingIngredientsText.innerHTML = `
          Your pachadi is missing ${missingIngredients.length} ingredient${missingIngredients.length > 1 ? 's' : ''}: 
          <strong>${missingNames}</strong>.
          This may make your year less balanced.${penaltyText}
        `;
      } else {
        missingIngredientsWarning.style.display = 'none';
      }
      
      return predictionText;
    }
    
    // Update results pie chart
    function updateResultsPieChart() {
      // Clear existing chart
      pieSlices_el.innerHTML = '';
      chartLegend_el.innerHTML = '';
      
      // Get tooltip element
      const tooltip = document.getElementById('pieChartTooltip');
      
      // Create pie slices
      const totalAmount = Object.values(vessel).reduce((a, b) => a + b, 0) || 1;
      let startAngle = 0;
      
      Object.entries(vessel).forEach(([taste, amount], index) => {
        if (amount === 0) return;
        
        const ingredient = ingredients.find(i => i.taste === taste);
        const percentage = amount / totalAmount;
        const degrees = percentage * 360;
        const endAngle = startAngle + degrees;
        
        // Calculate arc path
        const startRad = (startAngle - 90) * Math.PI / 180;
        const endRad = (endAngle - 90) * Math.PI / 180;
        const x1 = 50 + 48 * Math.cos(startRad);
        const y1 = 50 + 48 * Math.sin(startRad);
        const x2 = 50 + 48 * Math.cos(endRad);
        const y2 = 50 + 48 * Math.sin(endRad);
        
        // Determine if the arc is more than 180 degrees
        const largeArc = degrees > 180 ? 1 : 0;
        
        // Create path for slice
        const path = `M 50 50 L ${x1} ${y1} A 48 48 0 ${largeArc} 1 ${x2} ${y2} Z`;
        
        // Calculate midpoint for label
        const midAngleRad = (startAngle + degrees/2 - 90) * Math.PI / 180;
        const labelRadius = 30; // Distance from center for label
        const labelX = 50 + labelRadius * Math.cos(midAngleRad);
        const labelY = 50 + labelRadius * Math.sin(midAngleRad);
        
        // Create slice element
        const slice = document.createElementNS('http://www.w3.org/2000/svg', 'g');
        
        const slicePath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        slicePath.setAttribute('d', path);
        slicePath.setAttribute('fill', ingredient.color);
        
        // Add darker border for salt/tears to make it visible on the results page
        if (taste === 'salty') {
          slicePath.setAttribute('stroke', '#94a3b8'); // slate-400 for better visibility
          slicePath.setAttribute('stroke-width', '2');
        } else {
          slicePath.setAttribute('stroke', '#fff');
          slicePath.setAttribute('stroke-width', '1');
        }
        
        slicePath.setAttribute('data-taste', taste);
        slicePath.setAttribute('data-amount', amount);
        slicePath.setAttribute('data-percentage', Math.round(percentage * 100));
        slicePath.setAttribute('data-emotion', ingredient.emotion);
        slicePath.setAttribute('data-name', ingredient.name);
        
        // Add interactive events
        slicePath.addEventListener('mousemove', (e) => {
          const svgRect = document.getElementById('resultsPieChart').getBoundingClientRect();
          const tooltipContent = `
            <strong>${ingredient.name}</strong><br>
            ${ingredient.emotion}<br>
            Amount: ${amount} (${Math.round(percentage * 100)}%)
          `;
          
          tooltip.innerHTML = tooltipContent;
          tooltip.style.display = 'block';
          tooltip.style.left = (e.clientX - svgRect.left + 10) + 'px';
          tooltip.style.top = (e.clientY - svgRect.top + 10) + 'px';
        });
        
        slicePath.addEventListener('mouseout', () => {
          tooltip.style.display = 'none';
        });
        
        // Hover effect
        slicePath.addEventListener('mouseover', () => {
          slicePath.setAttribute('stroke-width', '2');
          slicePath.setAttribute('stroke', '#000');
        });
        
        slicePath.addEventListener('mouseout', () => {
          if (taste === 'salty') {
            slicePath.setAttribute('stroke-width', '2');
            slicePath.setAttribute('stroke', '#94a3b8'); // slate-400
          } else {
            slicePath.setAttribute('stroke-width', '1');
            slicePath.setAttribute('stroke', '#fff');
          }
        });
        
        slice.appendChild(slicePath);
        
        // Label for larger slices only
        if (percentage > 0.1) {
          const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          text.setAttribute('x', labelX);
          text.setAttribute('y', labelY);
          text.setAttribute('font-size', '7');
          text.setAttribute('font-weight', 'bold');
          text.setAttribute('text-anchor', 'middle');
          text.setAttribute('fill', ['sweet', 'sour', 'bitter', 'spicy'].includes(taste) ? 'white' : 'black');
          text.textContent = Math.round(percentage * 100) + '%';
          
          slice.appendChild(text);
        }
        
        pieSlices_el.appendChild(slice);
        
        // Add to legend if value > 0
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        
        const legendColor = document.createElement('div');
        legendColor.className = 'legend-color';
        legendColor.style.backgroundColor = ingredient.color;
        
        // Add border for salt in the legend for better visibility
        if (taste === 'salty') {
          legendColor.style.border = '2px solid #94a3b8'; // slate-400
        }
        
        const legendText = document.createElement('span');
        legendText.textContent = ingredient.emotion;
        
        legendItem.appendChild(legendColor);
        legendItem.appendChild(legendText);
        chartLegend_el.appendChild(legendItem);
        
        // Store current angle for next slice
        startAngle = endAngle;
      });
      
      // Add missing ingredients to legend with gray color
      missingIngredients.forEach(ingredient => {
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        
        const legendColor = document.createElement('div');
        legendColor.className = 'legend-color';
        legendColor.style.backgroundColor = '#d1d5db'; // gray-300
        
        const legendText = document.createElement('span');
        legendText.textContent = `${ingredient.emotion} (missing)`;
        legendText.style.color = '#6b7280'; // gray-500
        
        legendItem.appendChild(legendColor);
        legendItem.appendChild(legendText);
        chartLegend_el.appendChild(legendItem);
      });
    }
    
    // Show share modal with enhanced preview
    function showShareModal() {
      // Populate the share preview data
      updateSharePreview();
      
      // Show the modal
      document.getElementById('shareModal').style.display = 'flex';
    }
    
    // Close share modal
    function closeShareModal() {
      document.getElementById('shareModal').style.display = 'none';
    }
    
    // Update share preview content
    function updateSharePreview() {
      // Get prediction emoji based on dominant taste
      let predictionEmoji = 'ðŸŒŸ';
      let predictionTitle = 'Balanced Year Ahead';
      
      const dominantTaste = Object.entries(vessel).reduce((a, b) => (b[1] > a[1] ? b : a), [null, 0])[0];
      
      switch(dominantTaste) {
        case 'sweet':
          predictionEmoji = 'ðŸ˜Š';
          predictionTitle = 'A Year of Happiness';
          break;
        case 'sour':
          predictionEmoji = 'ðŸ’ª';
          predictionTitle = 'A Year of Challenges';
          break;
        case 'bitter':
          predictionEmoji = 'ðŸ§ ';
          predictionTitle = 'A Year of Growth';
          break;
        case 'spicy':
          predictionEmoji = 'ðŸ”¥';
          predictionTitle = 'An Exciting Year';
          break;
        case 'salty':
          predictionEmoji = 'ðŸ’§';
          predictionTitle = 'An Emotional Year';
          break;
        case 'astringent':
          predictionEmoji = 'âœ¨';
          predictionTitle = 'A Year of Surprises';
          break;
      }
      
      // Populate share preview fields
      document.getElementById('sharePredictionEmoji').textContent = predictionEmoji;
      document.getElementById('sharePredictionTitle').textContent = predictionTitle;
      document.getElementById('sharePredictionText').textContent = prediction;
      document.getElementById('shareScore').textContent = currentScore;
      document.getElementById('shareLevel').textContent = level;
      
      // Achievement if any
      if (achievement) {
        document.getElementById('shareAchievement').textContent = 'ðŸ† ' + achievement.name;
      } else {
        document.getElementById('shareAchievement').textContent = '';
      }
      
      // Also update modal share content
      document.getElementById('modalShareEmoji').textContent = predictionEmoji;
      document.getElementById('modalShareTitle').textContent = predictionTitle;
      document.getElementById('modalShareText').textContent = prediction;
      document.getElementById('modalShareScore').textContent = currentScore;
      document.getElementById('modalShareLevel').textContent = level;
      
      if (achievement) {
        document.getElementById('modalShareAchievement').textContent = 'ðŸ† ' + achievement.name;
      } else {
        document.getElementById('modalShareAchievement').textContent = '';
      }
      
      // Show the preview
      document.getElementById('sharePreview').style.display = 'block';
    }
    
    // Share to Twitter
    function shareTwitter() {
      const text = `${document.getElementById('modalShareTitle').textContent}: "${prediction}" #UgadiPachadi #NewYear2025 Score: ${currentScore}, Level: ${level}`;
      const url = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text);
      window.open(url, '_blank');
    }
    
    // Share to Facebook
    function shareFacebook() {
      const url = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(window.location.href);
      window.open(url, '_blank');
    }
    
    // Share to WhatsApp
    function shareWhatsApp() {
      const text = `${document.getElementById('modalShareTitle').textContent}: "${prediction}" Score: ${currentScore}, Level: ${level}`;
      const url = 'https://wa.me/?text=' + encodeURIComponent(text);
      window.open(url, '_blank');
    }
    
    // Copy to clipboard
    function copyToClipboard() {
      const text = `${document.getElementById('modalShareTitle').textContent}: "${prediction}" 
      
My Ugadi Pachadi Score: ${currentScore}, Level: ${level}
${achievement ? 'ðŸ† Achievement: ' + achievement.name : ''}

Created with Ugadi Pachadi Maker`;
      
      navigator.clipboard.writeText(text).then(() => {
        alert('Copied to clipboard!');
      }).catch(err => {
        console.error('Could not copy text: ', err);
        
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('Copied to clipboard!');
      });
    }
    
    // Legacy share function using Web Share API
    function shareResults() {
      // Create share text
      const shareTitle = document.getElementById('modalShareTitle').textContent;
      const shareText = `${prediction}\n\nMy Ugadi Pachadi Score: ${currentScore}, Level: ${level}`;
      
      // Check if the Web Share API is available
      if (navigator.share) {
        navigator.share({
          title: shareTitle,
          text: shareText,
        })
        .catch(error => {
          console.log('Error sharing:', error);
          alert('Could not share results. Please try again.');
        });
      } else {
        // Show modal instead as fallback
        showShareModal();
      }
    }
    
    // Initialize the game on load
    window.onload = init;
  </script>
</body>
</html>
Ugadi Pachadi maker.html
Displaying Ugadi Pachadi maker.html.
